/*C1*/SET SCHEMA SYSTEM_LOBS
INSERT INTO BLOCKS VALUES(0,2147483647,0)
COMMIT
/*C4*/SET SCHEMA PUBLIC
SET SCHEMA PUBLIC
SET SCHEMA PUBLIC
CREATE SCHEMA COOPERATIVA AUTHORIZATION SA
CREATE TABLE IF NOT EXISTS COOPERATIVA.usuario_cliente(\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009id_usuario VARCHAR(100) UNIQUE NOT NULL,\u000d\u000a\u0009contrasena VARCHAR(1000)  NOT NULL,\u000d\u000a\u0009rol BOOLEAN NOT NULL,\u000d\u000a\u0009fecha_nacimiento DATE,\u000d\u000a\u0009primer_nombre VARCHAR(100) NOT NULL,\u000d\u000a\u0009segundo_nombre VARCHAR(100),\u000d\u000a\u0009primer_apellido VARCHAR(100) NOT NULL,\u000d\u000a\u0009segundo_apellido VARCHAR(100),\u000d\u000a\u0009referencia VARCHAR(100),\u000d\u000a\u0009ciudad VARCHAR(100),\u000d\u000a\u0009avenida VARCHAR(100),\u000d\u000a\u0009casa VARCHAR(100),\u000d\u000a\u0009departamento VARCHAR(100),\u000d\u000a\u0009calle VARCHAR(100),\u000d\u000a\u0009correo_primario VARCHAR(100) NOT NULL,\u000d\u000a\u0009correo_secundario VARCHAR(100),\u000d\u000a\u0009fecha_de_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009fecha_ultima_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009usuario_creador VARCHAR(8) DEFAULT current_user,\u000d\u000a\u0009usuario_modificador VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.usuario_telefono(\u000d\u000a\u0009telefonos INT NOT NULL,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009PRIMARY KEY(codigo_empleado, telefonos),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cuenta(\u000d\u000a\u0009numero_cuenta VARCHAR(12)  NOT NULL,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009saldo DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009tipo VARCHAR(12) NOT NULL,\u000d\u000a\u0009fecha_de_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009fecha_ultima_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009usuario_creador VARCHAR(8),\u000d\u000a\u0009usuario_modificador VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY(numero_cuenta),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.transaccion(\u000d\u000a\u0009codigo_transaccion VARCHAR(100) NOT NULL,\u000d\u000a\u0009monto DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009comentario VARCHAR(256),\u000d\u000a\u0009numero_cuenta VARCHAR(12) NOT null,\u000d\u000a\u0009PRIMARY KEY(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(numero_cuenta) REFERENCES COOPERATIVA.cuenta(numero_cuenta)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.liquidacion(\u000d\u000a\u0009numero_liquidacion VARCHAR(8) NOT NULL,\u000d\u000a\u0009monto DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009fecha_de_retiro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009tipo VARCHAR(8) NOT NULL,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009PRIMARY KEY(numero_liquidacion),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.transaccion_liquidacion\u000d\u000a(\u000d\u000a\u0009codigo_transaccion VARCHAR(100) NOT NULL,\u000d\u000a\u0009numero_liquidacion VARCHAR(8) NOT NULL,\u000d\u000a\u0009PRIMARY KEY(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(codigo_transaccion) REFERENCES COOPERATIVA.transaccion(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(numero_liquidacion) REFERENCES COOPERATIVA.liquidacion(numero_liquidacion)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.prestamo(\u000d\u000a\u0009numero_prestamos VARCHAR(16)  not NULL,\u000d\u000a\u0009monto DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009fecha_de_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009saldo DECIMAL(10,2),\u000d\u000a\u0009periodos INT DEFAULT 12,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009fecha_ultima_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009usuario_creador VARCHAR(8),\u000d\u000a\u0009usuario_modificador VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY(numero_prestamos),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.pagos(\u000d\u000a\u0009numero_de_pago VARCHAR(5), \u000d\u000a\u0009capital DECIMAL(10,2),\u000d\u000a\u0009interes DOUBLE,\u000d\u000a\u0009numero_prestamos VARCHAR(16),\u000d\u000a\u0009PRIMARY KEY(numero_de_pago,numero_prestamos),\u000d\u000a\u0009FOREIGN KEY(numero_prestamos) REFERENCES COOPERATIVA.prestamo(numero_prestamos)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cierre\u000d\u000a(\u000d\u000a\u0009id_cierre INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\u000d\u000a\u0009fecha DATE DEFAULT CURRENT_DATE NOT NULL,\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cierre_pagos\u000d\u000a(\u000d\u000a\u0009numero_prestamos VARCHAR(16),\u000d\u000a\u0009numero_de_pago VARCHAR(5),\u000d\u000a\u0009id_cierre INTEGER,\u000d\u000a\u0009PRIMARY KEY (numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(numero_prestamos,numero_de_pago) REFERENCES COOPERATIVA.pagos(numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(id_cierre) REFERENCES COOPERATIVA.cierre(id_cierre)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cierre_transaccion\u000d\u000a(\u000d\u000a\u0009codigo_transaccion VARCHAR(100) not null,\u000d\u000a\u0009id_cierre INTEGER,\u000d\u000a\u0009PRIMARY KEY (codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(codigo_transaccion) REFERENCES COOPERATIVA.transaccion(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(id_cierre) REFERENCES  COOPERATIVA.cierre(id_cierre)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.dividendos\u000d\u000a(\u000d\u000a\u0009id_cierre INTEGER,\u000d\u000a\u0009id_usuario VARCHAR(8),\u000d\u000a\u0009ganancias DECIMAL(100,2),\u000d\u000a\u0009porcentaje DOUBLE,\u000d\u000a\u0009PRIMARY KEY(id_usuario),\u000d\u000a\u0009FOREIGN KEY(id_usuario) REFERENCES COOPERATIVA.usuario_cliente(id_usuario),\u000d\u000a\u0009FOREIGN KEY(id_cierre) REFERENCES  COOPERATIVA.cierre(id_cierre)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.liquidacion_pagos\u000d\u000a(\u000d\u000a\u0009numero_prestamos VARCHAR(16),\u000d\u000a\u0009numero_de_pago VARCHAR(5),\u000d\u000a\u0009numero_liquidacion VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY (numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(numero_prestamos,numero_de_pago) REFERENCES COOPERATIVA.pagos(numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(numero_liquidacion) REFERENCES COOPERATIVA.liquidacion(numero_liquidacion)\u000d\u000a)
--SEQUENCES\u000d\u000aCREATE SEQUENCE IF NOT EXISTS COOPERATIVA.codigo_empleado_seq\u000d\u000a\u0009START WITH 1\u000d\u000a\u0009INCREMENT BY 1
CREATE SEQUENCE IF NOT EXISTS COOPERATIVA.liquidacion_seq\u000d\u000a\u0009START WITH 1\u000d\u000a\u0009INCREMENT BY 1
--TRIGGERS\u000d\u000aDROP TRIGGER IF EXISTS usuario_cliente_tia
CREATE TRIGGER usuario_cliente_tia\u000d\u000aAFTER INSERT ON COOPERATIVA.usuario_cliente\u000d\u000aREFERENCING NEW ROW AS oldrow\u000d\u000aFOR EACH ROW\u000d\u000aBEGIN ATOMIC\u000d\u000a  INSERT INTO COOPERATIVA.cuenta(numero_cuenta,codigo_empleado,tipo,usuario_creador)VALUES (CONCAT(oldrow.codigo_empleado,'-CAR'),oldrow.codigo_empleado,'Retirable',oldrow.codigo_empleado);\u000d\u000a  INSERT INTO COOPERATIVA.cuenta(numero_cuenta,codigo_empleado,tipo,usuario_creador)  VALUES (CONCAT(oldrow.codigo_empleado,'-CAP'),oldrow.codigo_empleado,'Aportaciones',oldrow.codigo_empleado);\u000d\u000aEND
CREATE TRIGGER usuario_cliente_tib\u000d\u000aBEFORE INSERT ON COOPERATIVA.usuario_cliente\u000d\u000aREFERENCING NEW ROW AS newrow\u000d\u000aFOR EACH ROW\u000d\u000aBEGIN ATOMIC\u000d\u000a  SET newrow.codigo_empleado = CONCAT('AF-', LPAD(NEXT VALUE FOR COOPERATIVA.codigo_empleado_seq, 5, '0'));\u000d\u000aEND
DROP TRIGGER IF EXISTS liquidacion_tib
CREATE TRIGGER liquidacion_tib\u000d\u000aBEFORE INSERT ON COOPERATIVA.liquidacion\u000d\u000aREFERENCING NEW ROW AS newrow\u000d\u000aFOR EACH ROW\u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009SET newrow.numero_liquidacion = CONCAT('LIQ-', LPAD(NEXT VALUE FOR COOPERATIVA.liquidacion_seq, 5,'0'));\u000d\u000aEND
CREATE FUNCTION COOPERATIVA.conseguir_num_prestamo(numero VARCHAR(8))\u000d\u000aRETURNS BIGINT\u000d\u000aREADS SQL DATA\u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009DECLARE\u000d\u000a\u0009num_prestamo BIGINT;\u000d\u000a\u0009SET num_prestamo = SELECT count(*)\u000d\u000a\u0009FROM COOPERATIVA.prestamo\u000d\u000a\u0009WHERE codigo_empleado = numero;\u000d\u000a\u0009RETURN num_prestamo + 1;\u000d\u000aEND
CREATE SCHEMA IF NOT EXISTS cooperativa
CREATE TABLE IF NOT EXISTS COOPERATIVA.usuario_cliente(\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009id_usuario VARCHAR(100) UNIQUE NOT NULL,\u000d\u000a\u0009contrasena VARCHAR(1000)  NOT NULL,\u000d\u000a\u0009rol BOOLEAN NOT NULL,\u000d\u000a\u0009fecha_nacimiento DATE,\u000d\u000a\u0009primer_nombre VARCHAR(100) NOT NULL,\u000d\u000a\u0009segundo_nombre VARCHAR(100),\u000d\u000a\u0009primer_apellido VARCHAR(100) NOT NULL,\u000d\u000a\u0009segundo_apellido VARCHAR(100),\u000d\u000a\u0009referencia VARCHAR(100),\u000d\u000a\u0009ciudad VARCHAR(100),\u000d\u000a\u0009avenida VARCHAR(100),\u000d\u000a\u0009casa VARCHAR(100),\u000d\u000a\u0009departamento VARCHAR(100),\u000d\u000a\u0009calle VARCHAR(100),\u000d\u000a\u0009correo_primario VARCHAR(100) NOT NULL,\u000d\u000a\u0009correo_secundario VARCHAR(100),\u000d\u000a\u0009fecha_de_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009fecha_ultima_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009usuario_creador VARCHAR(8) DEFAULT current_user,\u000d\u000a\u0009usuario_modificador VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.usuario_telefono(\u000d\u000a\u0009telefonos INT NOT NULL,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009PRIMARY KEY(codigo_empleado, telefonos),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cuenta(\u000d\u000a\u0009numero_cuenta VARCHAR(12)  NOT NULL,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009saldo DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009tipo VARCHAR(12) NOT NULL,\u000d\u000a\u0009fecha_de_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009fecha_ultima_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009usuario_creador VARCHAR(8),\u000d\u000a\u0009usuario_modificador VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY(numero_cuenta),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.transaccion(\u000d\u000a\u0009codigo_transaccion VARCHAR(100) NOT NULL,\u000d\u000a\u0009monto DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009comentario VARCHAR(256),\u000d\u000a\u0009numero_cuenta VARCHAR(12) NOT null,\u000d\u000a\u0009PRIMARY KEY(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(numero_cuenta) REFERENCES COOPERATIVA.cuenta(numero_cuenta)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.liquidacion(\u000d\u000a\u0009numero_liquidacion VARCHAR(8) NOT NULL,\u000d\u000a\u0009monto DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009fecha_de_retiro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009tipo VARCHAR(8) NOT NULL,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009PRIMARY KEY(numero_liquidacion),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.transaccion_liquidacion\u000d\u000a(\u000d\u000a\u0009codigo_transaccion VARCHAR(100) NOT NULL,\u000d\u000a\u0009numero_liquidacion VARCHAR(8) NOT NULL,\u000d\u000a\u0009PRIMARY KEY(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(codigo_transaccion) REFERENCES COOPERATIVA.transaccion(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(numero_liquidacion) REFERENCES COOPERATIVA.liquidacion(numero_liquidacion)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.prestamo(\u000d\u000a\u0009numero_prestamos VARCHAR(16)  not NULL,\u000d\u000a\u0009monto DECIMAL(10,2) DEFAULT 0,\u000d\u000a\u0009fecha_de_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009saldo DECIMAL(10,2),\u000d\u000a\u0009periodos INT DEFAULT 12,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009fecha_ultima_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\u000d\u000a\u0009usuario_creador VARCHAR(8),\u000d\u000a\u0009usuario_modificador VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY(numero_prestamos),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.pagos(\u000d\u000a\u0009numero_de_pago VARCHAR(5), \u000d\u000a\u0009capital DECIMAL(10,2),\u000d\u000a\u0009interes DOUBLE,\u000d\u000a\u0009numero_prestamos VARCHAR(16),\u000d\u000a\u0009PRIMARY KEY(numero_de_pago,numero_prestamos),\u000d\u000a\u0009FOREIGN KEY(numero_prestamos) REFERENCES COOPERATIVA.prestamo(numero_prestamos)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cierre\u000d\u000a(\u000d\u000a\u0009id_cierre INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\u000d\u000a\u0009fecha DATE DEFAULT CURRENT_DATE NOT NULL,\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cierre_pagos\u000d\u000a(\u000d\u000a\u0009numero_prestamos VARCHAR(16),\u000d\u000a\u0009numero_de_pago VARCHAR(5),\u000d\u000a\u0009id_cierre INTEGER,\u000d\u000a\u0009PRIMARY KEY (numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(numero_prestamos,numero_de_pago) REFERENCES COOPERATIVA.pagos(numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(id_cierre) REFERENCES COOPERATIVA.cierre(id_cierre)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.cierre_transaccion\u000d\u000a(\u000d\u000a\u0009codigo_transaccion VARCHAR(100) not null,\u000d\u000a\u0009id_cierre INTEGER,\u000d\u000a\u0009PRIMARY KEY (codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(codigo_transaccion) REFERENCES COOPERATIVA.transaccion(codigo_transaccion),\u000d\u000a\u0009FOREIGN KEY(id_cierre) REFERENCES  COOPERATIVA.cierre(id_cierre)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.dividendos\u000d\u000a(\u000d\u000a\u0009id_cierre INTEGER,\u000d\u000a\u0009id_usuario VARCHAR(8),\u000d\u000a\u0009ganancias DECIMAL(100,2),\u000d\u000a\u0009porcentaje DOUBLE,\u000d\u000a\u0009PRIMARY KEY(id_usuario),\u000d\u000a\u0009FOREIGN KEY(id_usuario) REFERENCES COOPERATIVA.usuario_cliente(id_usuario),\u000d\u000a\u0009FOREIGN KEY(id_cierre) REFERENCES  COOPERATIVA.cierre(id_cierre)\u000d\u000a)
CREATE TABLE IF NOT EXISTS COOPERATIVA.liquidacion_pagos\u000d\u000a(\u000d\u000a\u0009numero_prestamos VARCHAR(16),\u000d\u000a\u0009numero_de_pago VARCHAR(5),\u000d\u000a\u0009numero_liquidacion VARCHAR(8),\u000d\u000a\u0009PRIMARY KEY (numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(numero_prestamos,numero_de_pago) REFERENCES COOPERATIVA.pagos(numero_prestamos,numero_de_pago),\u000d\u000a\u0009FOREIGN KEY(numero_liquidacion) REFERENCES COOPERATIVA.liquidacion(numero_liquidacion)\u000d\u000a)
--SEQUENCES\u000d\u000aCREATE SEQUENCE IF NOT EXISTS COOPERATIVA.codigo_empleado_seq\u000d\u000a\u0009START WITH 1\u000d\u000a\u0009INCREMENT BY 1
CREATE SEQUENCE IF NOT EXISTS COOPERATIVA.liquidacion_seq\u000d\u000a\u0009START WITH 1\u000d\u000a\u0009INCREMENT BY 1
--FUNCTIONS\u000d\u000aCREATE FUNCTION COOPERATIVA.emp_generador()\u000d\u000aRETURNS VARCHAR(8)\u000d\u000aCONTAINS SQL\u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009RETURN CONCAT('AF-', LPAD(NEXT VALUE FOR COOPERATIVA.codigo_empleado_seq, 5, '0'));\u000d\u000aEND \u000d\u000a\u000d\u000a
CREATE FUNCTION COOPERATIVA.conseguir_num_abono(numero VARCHAR(12))\u000d\u000aRETURNS BIGINT\u000d\u000aREADS SQL DATA\u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009DECLARE\u000d\u000a\u0009num_abono BIGINT;\u000d\u000a\u0009SET num_abono = SELECT count(*)\u000d\u000a\u0009FROM COOPERATIVA.transaccion\u000d\u000a\u0009WHERE numero_cuenta = numero;\u000d\u000a\u0009RETURN num_abono + 1;\u000d\u000aEND
CREATE FUNCTION COOPERATIVA.conseguir_num_pago(numero VARCHAR(16))\u000d\u000aRETURNS BIGINT\u000d\u000aREADS SQL DATA\u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009DECLARE\u000d\u000a\u0009num_pago BIGINT;\u000d\u000a\u0009SET num_pago = SELECT count(*)\u000d\u000a\u0009FROM COOPERATIVA.pagos\u000d\u000a\u0009WHERE numero_prestamos = numero;\u000d\u000a\u0009RETURN num_pago + 1;\u000d\u000aEND
--TRIGGERS\u000d\u000aDROP TRIGGER IF EXISTS usuario_cliente_tia
DROP TRIGGER IF EXISTS liquidacion_tib
CREATE TRIGGER prestamo_tib\u000d\u000aBEFORE INSERT ON COOPERATIVA.prestamo\u000d\u000aREFERENCING NEW ROW AS newrow\u000d\u000aFOR EACH ROW \u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009SET newrow.numero_prestamos = CONCAT(newrow.codigo_empleado, CONCAT('-',COOPERATIVA.conseguir_num_prestamo(newrow.codigo_empleado)));\u000d\u000aEND
CREATE TRIGGER  transaccion_tib\u000d\u000aBEFORE INSERT ON COOPERATIVA.transaccion\u000d\u000aREFERENCING NEW ROW AS newrow\u000d\u000aFOR EACH ROW \u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009SET  newrow.codigo_transaccion = CONCAT(newrow.numero_cuenta, CONCAT('-',COOPERATIVA.conseguir_num_abono(newrow.numero_cuenta)));\u000d\u000aEND
CREATE TRIGGER pagos_tib\u000d\u000aBEFORE INSERT ON COOPERATIVA.pagos\u000d\u000aREFERENCING NEW ROW AS newrow\u000d\u000aFOR EACH ROW \u000d\u000aBEGIN ATOMIC\u000d\u000a\u0009SET newrow.numero_de_pago = CONCAT(newrow.numero_prestamos, CONCAT('-',COOPERATIVA.conseguir_num_pago(newrow.numero_prestamos)));\u000d\u000aEND
SET SCHEMA COOPERATIVA
INSERT INTO USUARIO_CLIENTE VALUES('AF-00001','Admin','clave123',TRUE,NULL,'Super',NULL,'Admin',NULL,NULL,NULL,NULL,NULL,NULL,NULL,'SuperAdmin@gmail.com',NULL,'2025-03-10 11:18:34.807000','2025-03-10 11:18:34.807000','SA',NULL)
INSERT INTO CUENTA VALUES('AF-00001-CAR','AF-00001',0.00,'Retirable','2025-03-10 11:18:34.809000','2025-03-10 11:18:34.809000','AF-00001',NULL)
INSERT INTO CUENTA VALUES('AF-00001-CAP','AF-00001',0.00,'Aportaciones','2025-03-10 11:18:34.809000','2025-03-10 11:18:34.809000','AF-00001',NULL)
ALTER SEQUENCE COOPERATIVA.CODIGO_EMPLEADO_SEQ RESTART WITH 2
COMMIT
SET SCHEMA PUBLIC
DISCONNECT
/*C2*/SET SCHEMA PUBLIC
DISCONNECT
/*C3*/SET SCHEMA PUBLIC
DISCONNECT
/*C5*/SET SCHEMA COOPERATIVA
INSERT INTO USUARIO_CLIENTE VALUES('AF-00002','jomel','josue2307',TRUE,NULL,'Johnny','','Melgar','','','','','','','','jomelgar1903@gmail.com','','2025-03-10 11:20:16.837000','2025-03-10 11:20:16.837000','AF-00001',NULL)
INSERT INTO CUENTA VALUES('AF-00002-CAR','AF-00002',0.00,'Retirable','2025-03-10 11:20:16.837000','2025-03-10 11:20:16.837000','AF-00002',NULL)
INSERT INTO CUENTA VALUES('AF-00002-CAP','AF-00002',0.00,'Aportaciones','2025-03-10 11:20:16.837000','2025-03-10 11:20:16.837000','AF-00002',NULL)
ALTER SEQUENCE COOPERATIVA.CODIGO_EMPLEADO_SEQ RESTART WITH 3
COMMIT
/*C8*/SET SCHEMA PUBLIC
SET SCHEMA PUBLIC
SET SCHEMA PUBLIC
/*C5*/DELETE FROM USUARIO_CLIENTE WHERE CODIGO_EMPLEADO='AF-00002'
INSERT INTO USUARIO_CLIENTE VALUES('AF-00002','jomel','josue2307',TRUE,NULL,'Johnny','','Melgar','','Costa Verde Villas','San Pedro Sula','','Casa #22','Cortes','15 Calle SO','jomelgar1903@gmail.com','','2025-03-10 11:20:16.837000','2025-03-10 00:00:00.000000','AF-00001','AF-00002')
COMMIT
SET SCHEMA PUBLIC
DISCONNECT
/*C6*/SET SCHEMA PUBLIC
DROP TABLE PUBLIC.COOPERATIVA.USUARIO_TELEFONO
/*C8*/CREATE TABLE IF NOT EXISTS COOPERATIVA.usuario_telefono(\u000d\u000a\u0009telefonos VARCHAR(8) NOT NULL,\u000d\u000a\u0009codigo_empleado VARCHAR(8) NOT NULL,\u000d\u000a\u0009PRIMARY KEY(codigo_empleado, telefonos),\u000d\u000a\u0009FOREIGN KEY(codigo_empleado) REFERENCES COOPERATIVA.usuario_cliente(codigo_empleado)\u000d\u000a)
DISCONNECT
/*C6*/DISCONNECT
/*C7*/SET SCHEMA PUBLIC
DISCONNECT
/*C9*/SET SCHEMA COOPERATIVA
DELETE FROM USUARIO_CLIENTE WHERE CODIGO_EMPLEADO='AF-00002'
INSERT INTO USUARIO_CLIENTE VALUES('AF-00002','jomel','josue2307',TRUE,NULL,'Johnny','','Melgar','','Costa Verde Villas','San Pedro Sula','','Casa #22','Cortes','15 Calle SO','jomelgar1903@gmail.com','','2025-03-10 11:20:16.837000','2025-03-10 00:00:00.000000','AF-00001','AF-00002')
COMMIT
SET SCHEMA PUBLIC
DISCONNECT
/*C11*/SET SCHEMA COOPERATIVA
DELETE FROM USUARIO_CLIENTE WHERE CODIGO_EMPLEADO='AF-00002'
INSERT INTO USUARIO_CLIENTE VALUES('AF-00002','jomel','josue2307',TRUE,NULL,'Johnny','','Melgar','','Costa Verde Villas','San Pedro Sula','','Casa #22','Cortes','15 Calle SO','jomelgar1903@gmail.com','','2025-03-10 11:20:16.837000','2025-03-10 00:00:00.000000','AF-00001','AF-00002')
COMMIT
INSERT INTO USUARIO_TELEFONO VALUES('88189119','AF-00002')
COMMIT
SET SCHEMA PUBLIC
DISCONNECT
/*C12*/SET SCHEMA PUBLIC
DISCONNECT
/*C13*/SET SCHEMA PUBLIC
DISCONNECT
/*C14*/SET SCHEMA PUBLIC
DISCONNECT
/*C15*/SET SCHEMA PUBLIC
DISCONNECT
/*C16*/SET SCHEMA PUBLIC
DISCONNECT
/*C17*/SET SCHEMA PUBLIC
DISCONNECT
/*C18*/SET SCHEMA PUBLIC
DISCONNECT
/*C19*/SET SCHEMA PUBLIC
DISCONNECT
/*C20*/SET SCHEMA PUBLIC
DISCONNECT
